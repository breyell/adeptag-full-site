{% set line = fn('Timber::get_post', line) %}

<section
  x-data="{ width: 0 }"
  x-resize="width = $width"
  class="fluid-grid relative pb-10 lg:pb-20"
>
  <div class="span-content pb-8 bg-white border-b border-b-black">
    <div class="pb-4">
      <div class="relative py-8">
        {% set timber_image = fn('Timber::get_image', line.image) %}
        <div class="">
          <div style="aspect-ratio: {{ timber_image.width }}/{{ timber_image.height }};">
            {{ ResponsiveImage(line.image, {
              class: 'relative z-20 size-full max-w-none lg:h-auto px-1 pointer-events-none',
              sizes: '(min-width: 1020px) 1280px, 1024px',
            }) }}
          </div>
          <div class="flex gap-x-3 size-full absolute z-10 inset-0">
            {% for item in line.products %}
              {% set product = fn('Timber::get_post', item.product) %}
              <a
                href="#{{ loop.index }}"
                class="group relative block size-full border border-green-lime rounded-xl transition-colors hover:bg-[#DEF8BE]"
                style="width: {{ item.width }}%;"
              >
                <div
                  class="absolute left-1/2 top-[calc(100%-1px)] -translate-1/2 size-9 rounded-full border border-green-lime bg-white flex items-center justify-center transition-colors group-hover:bg-green-lime/90"
                >{{ loop.index }}</div>
              </a>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="span-content grid grid-cols-subgrid">
    {% for item in line.products %}
      {% set item_index = loop.index %}
      {% set products = [item.product, item.product_two] %}
      <div
        id="{{ item_index }}"
        class="span-content grid grid-cols-subgrid lg:scroll-mt-17"
      >
        {% for product in products %}
          {% if product %}
            {% set product = fn('Timber::get_post', product) %}
            <article
              x-data="{ open: false }"
              class="span-content grid grid-cols-subgrid py-5 lg:pt-7 lg:pb-14 border-b border-b-black text-blue-dark bg-white"
            >
              <button
                @click="open = !open"
                class="group col-span-12 flex items-center gap-x-4 lg:mb-7"
              >
                <div
                  class="flex items-center justify-center size-9 rounded-full bg-green-light text-tag shrink-0"
                >
                  {% if item.product_two %}
                    {% if loop.first %}
                      {{ item_index }}a
                    {% else %}
                      {{ item_index }}b
                    {% endif %}
                  {% else %}
                    {{ item_index }}
                  {% endif %}
                </div>
                <h3 class="text-h4 text-left group-hover:underline">{{ product.title }}</h3>
                <div class="relative size-9 rounded-full border-2 border-blue-dark shrink-0 ml-auto">
                  <div class="absolute top-1/2 left-1/2 -translate-1/2 w-4 h-0.5 bg-blue-dark"></div>
                  <div
                    :class="open && 'scale-0'"
                    class="absolute top-1/2 left-1/2 -translate-1/2 w-0.5 h-4 bg-blue-dark transition-transform"
                  ></div>
                </div>
              </button>
              <div
                x-show="open || width >= 1024"
                x-cloak
                x-collapse
                class="span-content grid grid-cols-subgrid mt-4 lg:mt-0"
              >
                <div class="col-span-12 lg:col-span-5">
                  {{ ResponsiveImage(product.featured_image, {
                    class: 'w-full',
                    sizes: '(min-width: 1020px) 40vw, (min-width: 1408px) 515px, 100vw',
                  }) }}
                </div>
                <div class="col-span-12 mt-6 lg:mt-0 lg:col-span-6 lg:col-start-7">
                  <p class="text-b2 text-blue-dark">{{ product.hero_overview }}</p>
                  {% if product.bulleted_list %}
                    <ul class="list-disc list-inside pl-1 space-y-6.5">
                      {% for bullet in product.hero_bulleted_list %}
                        <li class="text-b2 text-blue-dark">{{ bullet.text }}</li>
                      {% endfor %}
                    </ul>
                  {% endif %}
                </div>
                <div
                  x-show="open || width < 1024"
                  x-cloak
                  x-collapse
                  class="span-content grid grid-cols-subgrid"
                >
                  {# tabs #}
                  <div
                    x-data="{ activeTab: 0 }"
                    class="col-span-12 mt-6"
                  >
                    <div class="overflow-x-auto px-[calc(var(--side-width)+var(--col-gap))] -mx-[calc(var(--side-width)+var(--col-gap))]">
                      <div class="flex gap-x-5 -ml-2 lg:gap-x-10 lg:-ml-5">
                        {% for tab in product.specifications_tabs %}
                          <button
                            @click="activeTab = {{ loop.index0 }}"
                            :class="activeTab === {{ loop.index0 }} && 'underline'"
                            class="p-2 lg:px-5 shrink-0"
                          ><h3 class="text-b1 font-bold">{{ tab.heading }}</h3></button>
                        {% endfor %}
                      </div>
                    </div>
                    <div class="mt-9 relative" x-auto-animate>
                      {% for tab in product.specifications_tabs %}
                        <div
                          x-show="activeTab === {{ loop.index0 }}"
                          x-cloak
                          x-transition:enter="transition-opacity ease-out duration-300"
                          x-transition:enter-start="opacity-0"
                          x-transition:enter-end="opacity-100"
                          x-transition:leave="transition ease-in duration-300 absolute top-0 left-0"
                          x-transition:leave-start="opacity-100"
                          x-transition:leave-end="opacity-0"
                          class=""
                        >
                          {% for item in tab.content %}
                            {% if item.acf_fc_layout == 'wysiwyg' %}
                              <div
                                class="
                                  wysiwyg
                                  {% if item.columns == 2 %}
                                    lg:columns-2
                                  {% endif %}
                                "
                              >{{ item.wysiwyg }}</div>
                            {% elseif item.acf_fc_layout == 'features' %}
                              <div class="grid grid-cols-1 gap-8 md:gap-16 md:grid-cols-2 lg:grid-cols-3">
                                {% for feature in item.features %}
                                  <div class="">
                                    <h4 class="text-b2 font-bold">{{ feature.heading }}</h4>
                                    <p class="text-b2 mt-2">{{ feature.body }}</p>
                                  </div>
                                {% endfor %}
                              </div>
                            {% endif %}
                          {% endfor %}
                        </div>
                      {% endfor %}
                    </div>
                  </div>
                </div>
              </div>
            </article>
          {% endif %}
        {% endfor %}
      </div>
    {% endfor %}
  </div>
</section>
